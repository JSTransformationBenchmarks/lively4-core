# User-defined Vivide Content

<span style="color: red; font-weight: bold;">CAUTION!</span>
Press the button to delete the corresponding file:

<script>
import { scriptFolder, stepFolder, applicationFolder } from 'src/client/vivide/utils.js';
import Script from 'src/client/vivide/vividescript.js';
import View from 'src/client/vivide/components/vivide-view.js';
import { fileName, flatten } from 'utils';
import { createView } from 'src/client/vivide/scripts/loading.js';

(async () => {
  let autoGenerated = /(.*-template\.js(on)?$)|(.md?$)/;
  let deleteFunctions = [];
  let folders = [scriptFolder, stepFolder, applicationFolder];
  let fileNames = (await Promise.all(folders.map(async folderURL => {
    let folder = JSON.parse(await lively.files.statFile(folderURL));
    let filenames = folder.contents
      .filter(({ type }) => type === 'file')
      .map(({ name }) => name)
      .filter(name => !autoGenerated.test(name))
      .map(name => folderURL+name);
    return filenames;
  })));
  let buttonList = fileNames.map((folder, i) => <div>
  <h5>{folders[i].split('/')[folders[i].split('/').length-2]}/</h5>
  {...folder.map(urlString => {
    let del = async evt => {
      let delResponse = await fetch(urlString, { method: 'DELETE' });
      if (delResponse.status === 200) {
        lively.success(`deleted file ${urlString::fileName()}`);
        file.remove();
        deleteFunctions = deleteFunctions.filter(df => df !== del);
      } else {
        lively.notify("could not properly delete " + urlString, (await delResponse.text()));
      }
    }
    deleteFunctions.push(del);
    let delbutton = <button click={del}>
      <span style="color: red; font-weight: bold;">Delete</span>
    </button>;
    
    let openbutton = <button click={async () => {
      const filepath = urlString.split('/');
      const content = JSON.parse(await lively.files.loadFile(urlString));
      const name = filepath[filepath.length-1].split('.')[0];
      await createView(content, i === 0, i === 2, name);
    }}>
      <span style="color: blue; font-weight: bold;">Open</span>
    </button>;

    let file = <div>{urlString.split('/')[urlString.split('/').length-1]} {delbutton} {openbutton}</div>;
    return file;
  })}</div>);
  
  let deleteAllScriptsButton = <button click={async evt => {
    await Promise.all(deleteFunctions.map(f => f()));
    lively.success('removed all scripts');
  }}><span style="color: red; font-weight: bold;">DELETE ALL SCRIPTS!</span></button>;

  return <div>
    {deleteAllScriptsButton}
    <div>{...buttonList}</div>
  </div>;
})();
</script>